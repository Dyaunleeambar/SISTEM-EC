<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Evaluación de Colaboradores</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <div class="main-container">
    <!-- Tarjeta fija arriba -->
    <div class="header-card">
      <div class="header-flex">
        <div class="header-main">
          <h1 class="header-title">Sistema de Estimulación para los Colaboradores</h1>
          <div class="counters">
            <div class="counter">
              <i class="fas fa-users counter-icon"></i>
              <span id="totalCollaborators" class="counter-value">0</span>
            </div>
            <div class="counter">
              <i class="fas fa-star counter-icon"></i>
              <span id="withStimulation" class="counter-value">0</span>
            </div>
            <div class="counter">
              <i class="far fa-star counter-icon"></i>
              <span id="withoutStimulation" class="counter-value">0</span>
            </div>
            <div class="counter">
              <i class="fas fa-umbrella-beach counter-icon"></i>
              <span id="onVacation" class="counter-value">0</span>
            </div>
            <div class="counter">
              <i class="fas fa-flag-checkered counter-icon"></i>
              <span id="endOfMission" class="counter-value">0</span>
            </div>            
          </div>
          <div id="messageBox" class="message-box"></div>
          <div class="import-section">
            <h2>Gestión de Datos</h2>                 
            <div class="add-collaborator-section">              
              <form id="addCollaboratorForm">
                  <input type="text" id="estadoInput" placeholder="Ubicación/Estado" required>
                  <input type="text" id="nombreInput" placeholder="Nombre y Apellidos" required>                  
                  <button type="submit">Agregar</button>
                  <button id="exportButton" type="button">Exportar a Excel</button>
                  <button id="cleanOldEndMissionButton" type="button" style="background:#f44336;color:#fff;margin-left:8px;">Limpiar Fin de Misión antiguos</button>
                  <div class="conciliation-section">
                    <label for="conciliationMonth">Mes de Conciliación:</label>
                    <input type="month" id="conciliationMonth">
                    <input type="text" id="searchInput" placeholder="Buscar colaborador...">
                  </div>                  
              </form>
            </div>                           
          </div>          
        </div>
        <div class="state-counters-card">
          <h3>Contadores por Estado</h3>
          <div id="stateCountersContent" class="location-buttons">
            <!-- Aquí se generan los botones dinámicamente -->
          </div>
        </div>
      </div>
    </div>

    <!-- Tarjeta de la tabla (scrollable) -->
    <div class="table-card">
      <!-- Tabla de colaboradores -->
      <table id="collaboratorsTable">
          <thead>
              <tr>
                <th>Estado</th>
                <th>Nombre del Colaborador</th>
                <th>Fecha de Salida</th>
                <th>Fecha de Entrada</th>
                <th title="Derecho a estimulación si permanece al menos 15 días en el país"><i class="fas fa-star"></i></th>
                <th title="Vacaciones si tiene fecha de salida y no de entrada"><i class="fas fa-umbrella-beach"></i></th>
                <th title="Fin de Misión si el checkbox está marcado en edición"><i class="fas fa-flag-checkered"></i></th>
                <th title="Días que el colaborador estuvo en el país durante el mes de conciliación"><i class="fas fa-calendar-day"></i></th>
                <th><i class="fas fa-tools"></i></th>
              </tr>
          </thead>
          <tbody>
              <!-- Datos se cargarán dinámicamente -->
          </tbody>
      </table>
    </div>
  </div>
    <!-- Modal de edición -->
    <div id="editModal" class="modal" style="display:none;">
      <div class="modal-content">
        <span id="closeEditModal" class="close">&times;</span>
        <h3>Editar Colaborador</h3>
        <form id="editCollaboratorForm">
          <input type="hidden" id="editId">
          <input type="text" id="editNombre" placeholder="Nombre y Apellidos" required>
          <input type="text" id="editEstado" placeholder="Ubicación/Estado" required>
          <input type="date" id="editFechaSalida" placeholder="Fecha de Salida">
          <input type="date" id="editFechaEntrada" placeholder="Fecha de Entrada">
          <button type="submit">Guardar Cambios</button>
        </form>
      </div>
    </div>
    <!-- Modal de exportación -->
    <div id="exportModal" class="modal" style="display:none;">
      <div class="modal-content">
        <span id="closeExportModal" class="close">&times;</span>
        <h3>¿Qué datos deseas exportar?</h3>
        <button id="exportAllBtn"><i class="fas fa-file-excel"></i> Exportar toda la base de datos</button>
        <button id="exportFilteredBtn" style="margin-top: 12px;"><i class="fas fa-file-excel"></i> Exportar solo lo visible en la tabla</button>
      </div>
    </div>
    <!-- Modal de limpieza Fin de Misión antiguos -->
    <div id="cleanEndMissionModal" class="modal" style="display:none;">
      <div class="modal-content" style="width: 520px; min-width: 400px; max-width: 90vw;">
        <span id="closeCleanEndMissionModal" class="close">&times;</span>
        <h3>Eliminar colaboradores de Fin de Misión antiguos</h3>
        <div id="cleanEndMissionList" style="max-height:220px;overflow-y:auto;margin-bottom:16px;"></div>
        <div id="cleanEndMissionWarning" style="color:#f44336;margin-bottom:18px;"></div>
        <div style="display:flex;gap:16px;justify-content:flex-end;">
          <button id="confirmCleanEndMissionBtn" style="background:#f44336;color:#fff;">Confirmar eliminación</button>
          <button id="cancelCleanEndMissionBtn">Cancelar</button>
        </div>
      </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="app.js"></script>
</body>
</html>
